<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Perspective Platform with Clipping</title>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; }
        canvas { background: lightgray; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>3D Perspective Platform with Clipping</h1>
    <canvas id="canvas"></canvas>
    <p>Use arrow keys to move</p>

    <script>
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");

        canvas.width = 500;
        canvas.height = 500;

        let player = { x: 0, y: 5, z: -30 }; // Player's position

        const platform = [
            { x: -20, y: 0, z: -20 },
            { x: 20, y: 0, z: -20 },
            { x: 20, y: 0, z: 20 },
            { x: -20, y: 0, z: 20 }
        ];

        // Project a point with perspective
        function project(point) {
            let scale = 200 / (point.z - player.z + 100);
            return {
                x: canvas.width / 2 + (point.x - player.x) * scale,
                y: canvas.height / 2 - (point.y - player.y) * scale,
                z: point.z
            };
        }

        // Draw the platform with clipping
        function drawPlatform() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            let projected = platform.map(project);

            // Only keep points that are in front of the player
            projected = projected.filter(p => p.z > player.z);

            if (projected.length < 2) return; // If less than 2 points are visible, do nothing

            ctx.beginPath();
            for (let i = 0; i < projected.length; i++) {
                let next = projected[(i + 1) % projected.length];
                ctx.moveTo(projected[i].x, projected[i].y);
                ctx.lineTo(next.x, next.y);
            }
            ctx.strokeStyle = "black";
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        // Update function to draw the platform
        function update() {
            drawPlatform();
            setTimeout(update, 1000);
        }

        // Keyboard movement controls
        document.addEventListener("keydown", (e) => {
            if (e.key === "ArrowUp") player.z += 2;
            if (e.key === "ArrowDown") player.z -= 2;
            if (e.key === "ArrowLeft") player.x -= 2;
            if (e.key === "ArrowRight") player.x += 2;
            drawPlatform();
        });

        update();
    </script>
</body>
</html>
